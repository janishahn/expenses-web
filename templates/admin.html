{% extends "base.html" %}
{% block content %}
<section class="space-y-6">
    <div class="space-y-2">
        <p class="metric-eyebrow text-xs text-slate-500 dark:text-slate-400">Control center</p>
        <h1 class="text-3xl font-semibold tracking-tight text-slate-800 dark:text-slate-100">Admin</h1>
        <p class="text-slate-500 dark:text-slate-400">Back up data, export archives, and keep the ledger tidy.</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <article class="card shadow-hover space-y-0">
            <div class="info-card-accent" style="background: #6366f1;"></div>
            <div class="card-body space-y-3">
                <h2 class="text-xl font-semibold tracking-tight text-slate-800 dark:text-slate-100">Database Backups</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400">Download a complete SQLite dump so you can restore everything if something goes sideways.</p>
                <a href="/admin/download-db" class="btn btn-primary btn-lg w-full">Download backup</a>
            </div>
        </article>

        <article class="card shadow-hover space-y-0">
            <div class="info-card-accent" style="background: #22c55e;"></div>
            <div class="card-body space-y-3">
                <h2 class="text-xl font-semibold tracking-tight text-slate-800 dark:text-slate-100">Export Transactions</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400">Grab a CSV of every transaction for auditing or to bring into spreadsheets.</p>
                <form method="post" action="/admin/export-csv">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-primary btn-lg w-full">Export CSV</button>
                </form>
            </div>
        </article>

        <article class="card shadow-hover space-y-0">
            <div class="info-card-accent" style="background: #38bdf8;"></div>
            <div class="card-body space-y-3">
                <h2 class="text-xl font-semibold tracking-tight text-slate-800 dark:text-slate-100">Import</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400">Import transactions from CSV or a legacy SQLite database.</p>
                <a href="/admin/import" class="btn btn-secondary btn-lg w-full">Open importer</a>
            </div>
        </article>

        <article class="card shadow-hover space-y-0">
            <div class="info-card-accent" style="background: #f43f5e;"></div>
            <div class="card-body space-y-3">
                <h2 class="text-xl font-semibold tracking-tight text-slate-800 dark:text-slate-100">Housekeeping</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400">Purge soft-deleted transactions older than a safe window to keep the database lean.</p>
                <form method="post"
                      action="/admin/purge-deleted"
                      hx-post="/admin/purge-deleted"
                      hx-swap="none"
                      hx-on::afterRequest="window.ui?.showToast('Deleted transactions purged')"
                      onsubmit="return confirm('Purge deleted transactions? This cannot be undone.')">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <label class="space-y-1 text-xs font-semibold text-slate-500 dark:text-slate-400">
                        Older than (days)
                        <input type="number" name="days" value="30" min="1" max="365" class="input">
                    </label>
                    <button type="submit" class="btn btn-primary btn-lg w-full mt-3">Purge now</button>
                </form>
            </div>
        </article>

        <article class="card shadow-hover space-y-0">
            <div class="info-card-accent" style="background: #fb923c;"></div>
            <div class="card-body space-y-3">
                <h2 class="text-xl font-semibold tracking-tight text-slate-800 dark:text-slate-100">Rebuild Rollups</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400">Recalculate monthly aggregates from the transaction ledger (use after imports or adjustments policy changes).</p>
                <form method="post"
                      action="/admin/rebuild-rollups"
                      hx-post="/admin/rebuild-rollups"
                      hx-swap="none"
                      hx-on::afterRequest="window.ui?.showToast('Rollups rebuilt')"
                      onsubmit="return confirm('Rebuild monthly rollups now?')">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-primary btn-lg w-full">Rebuild now</button>
                </form>
            </div>
        </article>
    </div>

    <div class="card shadow-hover">
        <div class="card-header">
            <h2 class="text-xl font-semibold tracking-tight text-slate-800 dark:text-slate-100">System information</h2>
        </div>
        <div class="card-body grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="card" data-elevation="0">
                <div class="card-body space-y-1">
                    <p class="metric-eyebrow">App version</p>
                    <p class="font-semibold text-slate-800 dark:text-slate-100">{{ app_version }}</p>
                </div>
            </div>
            <div class="card" data-elevation="0">
                <div class="card-body space-y-1">
                    <p class="metric-eyebrow">Environment</p>
                    <p class="font-semibold text-slate-800 dark:text-slate-100">{{ environment }}</p>
                </div>
            </div>
            <div class="card" data-elevation="0">
                <div class="card-body space-y-1">
                    <p class="metric-eyebrow">Database</p>
                    <p class="font-semibold text-slate-800 dark:text-slate-100">{{ db_path }}</p>
                </div>
            </div>
            <div class="card" data-elevation="0">
                <div class="card-body space-y-1">
                    <p class="metric-eyebrow">DB size</p>
                    <p class="font-semibold text-slate-800 dark:text-slate-100">{{ db_size_mb }} MB</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
