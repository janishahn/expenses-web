{% from "macros.html" import icon %}
<div id="insights-top-categories"
     hx-get="/components/insights/top-categories"
     hx-trigger="filtersChanged from:#insights-filters"
     hx-include="#insights-filter-form"
     hx-swap="outerHTML"
     class="card shadow-hover">
    <div class="card-header">
        <p class="metric-eyebrow">Breakdown</p>
        <h3 class="text-xl font-semibold tracking-tight text-slate-800 dark:text-slate-100">Top categories</h3>
    </div>
    <div class="separator"></div>
    <div class="card-body space-y-6">
        <div>
            <p class="text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3">Expenses</p>
            {% if expense_breakdown %}
            {% set total = (expense_breakdown | map(attribute='amount_cents') | sum) %}
            <div class="space-y-2">
                {% for row in expense_breakdown[:8] %}
                <div class="flex items-center justify-between gap-4">
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-slate-800 dark:text-slate-100 truncate">{{ row.name }}</p>
                        <div class="h-2 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden mt-1">
                            <div class="h-2 bg-rose-500 rounded-full" style="width: {{ row.percent }}%"></div>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="tabular font-semibold text-rose-500">{{ row.amount_cents|currency }} €</p>
                        <p class="text-xs text-slate-500 dark:text-slate-400 tabular">{{ "%.1f"|format(row.percent) }}%</p>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-sm text-slate-500 dark:text-slate-400">No expenses in this period.</p>
            {% endif %}
        </div>

        <div>
            <p class="text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3">Income</p>
            {% if income_breakdown %}
            <div class="space-y-2">
                {% for row in income_breakdown[:8] %}
                <div class="flex items-center justify-between gap-4">
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-slate-800 dark:text-slate-100 truncate">{{ row.name }}</p>
                        <div class="h-2 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden mt-1">
                            <div class="h-2 bg-emerald-500 rounded-full" style="width: {{ row.percent }}%"></div>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="tabular font-semibold text-emerald-500">{{ row.amount_cents|currency }} €</p>
                        <p class="text-xs text-slate-500 dark:text-slate-400 tabular">{{ "%.1f"|format(row.percent) }}%</p>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-sm text-slate-500 dark:text-slate-400">No income in this period.</p>
            {% endif %}
        </div>
    </div>
</div>
