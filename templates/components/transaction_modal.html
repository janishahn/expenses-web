{% from "macros.html" import icon %}
<dialog id="transaction-modal" class="modal">
    <form id="transaction-form" hx-post="/transactions" hx-swap="none" hx-trigger="submit"
        hx-on:htmx:after-request="if(event.detail.successful){ this.reset(); document.getElementById('transaction-modal')?.close(); window.ui?.showToast('Transaction added successfully!'); }"
        hx-on:htmx:response-error="window.ui?.showToast(window.ui?.httpErrorMessage?.(event.detail.xhr) || 'Unable to add transaction', 'error')"
        class="modal-form space-y-6">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="space-y-1">
            <p class="metric-eyebrow">Capture</p>
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-semibold tracking-tight text-slate-800 dark:text-slate-100">Add transaction
                </h3>
                <button type="button" class="btn btn-ghost btn-icon" data-close-transaction aria-label="Close">
                    {{ icon("x", class="icon") }}
                </button>
            </div>
            <p class="text-sm text-slate-500 dark:text-slate-400">Adds an entry and refreshes dashboard panels.</p>
        </div>
        <div class="separator"></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <label class="space-y-1 text-sm font-semibold text-slate-600 dark:text-slate-300">
                When
                <input type="datetime-local" name="occurred_at" value="{{ now_local() }}" class="input" required>
            </label>
            <label class="space-y-1 text-sm font-semibold text-slate-600 dark:text-slate-300">
                Amount
                <input type="text" name="amount" placeholder="12.34" inputmode="decimal" class="input" required>
            </label>
        </div>
        <label class="space-y-1 text-sm font-semibold text-slate-600 dark:text-slate-300">
            Category
            <select name="category_id" class="select" required>
                <option value="">-- Select category --</option>
                <optgroup label="Income">
                    {% for category in categories %}
                    {% if category.type.value == 'income' %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endif %}
                    {% endfor %}
                </optgroup>
                <optgroup label="Expense">
                    {% for category in categories %}
                    {% if category.type.value == 'expense' %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endif %}
                    {% endfor %}
                </optgroup>
            </select>
        </label>
        <label class="space-y-1 text-sm font-semibold text-slate-600 dark:text-slate-300">
            Description
            <input type="text" name="note" placeholder="e.g., Lunch with Alex" class="input" required>
        </label>
        <div class="space-y-1 tag-input-container" data-available-tags='{{ tags|tojson|safe }}'>
            <span class="text-sm font-semibold text-slate-600 dark:text-slate-300">Tags</span>
            <input type="hidden" name="tags" value="">
            <div class="tag-input-wrapper">
                <div class="tag-chips"></div>
                <input type="text" class="tag-text-input" placeholder="Add tags...">
            </div>
            <div class="tag-suggestions"></div>
        </div>
        <div class="flex flex-col-reverse sm:flex-row sm:justify-end gap-3">
            <button type="button" class="btn btn-ghost" data-close-transaction>Cancel</button>
            <button type="submit" class="btn btn-primary btn-lg">Add Transaction</button>
        </div>
    </form>
</dialog>
